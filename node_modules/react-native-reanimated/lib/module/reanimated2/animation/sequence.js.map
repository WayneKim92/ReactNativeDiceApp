{"version":3,"names":["defineAnimation","getReduceMotionForAnimation","withSequence","_reduceMotionOrFirstAnimation","_len","arguments","length","_animations","Array","_key","reduceMotion","unshift","console","warn","onStart","animation","value","current","onFrame","animationIndex","animations","map","a","result","finished","findNextNonReducedMotionAnimationIndex","index","callback","forEach","sequence","now","currentAnim","nextAnim","previousAnimation","anim","undefined","currentAnimation","isHigherOrder"],"sources":["sequence.ts"],"sourcesContent":["import { defineAnimation, getReduceMotionForAnimation } from './util';\nimport type { NextAnimation, SequenceAnimation } from './commonTypes';\nimport type {\n  Animation,\n  AnimatableValue,\n  AnimationObject,\n  ReduceMotion,\n  Timestamp,\n} from '../commonTypes';\n\nexport function withSequence<T extends AnimatableValue>(\n  _reduceMotion: ReduceMotion,\n  ...animations: T[]\n): T;\n\nexport function withSequence<T extends AnimatableValue>(...animations: T[]): T;\n\nexport function withSequence(\n  _reduceMotionOrFirstAnimation?: ReduceMotion | NextAnimation<AnimationObject>,\n  ..._animations: NextAnimation<AnimationObject>[]\n): Animation<SequenceAnimation> {\n  'worklet';\n  let reduceMotion: ReduceMotion | undefined;\n\n  // the first argument is either a config or an animation\n  // this is done to allow the reduce motion config prop to be optional\n  if (_reduceMotionOrFirstAnimation) {\n    if (typeof _reduceMotionOrFirstAnimation === 'string') {\n      reduceMotion = _reduceMotionOrFirstAnimation as ReduceMotion;\n    } else {\n      _animations.unshift(\n        _reduceMotionOrFirstAnimation as NextAnimation<AnimationObject>\n      );\n    }\n  }\n\n  if (_animations.length === 0) {\n    console.warn('[Reanimated] No animation was provided for the sequence');\n\n    return defineAnimation<SequenceAnimation>(0, () => {\n      'worklet';\n      return {\n        onStart: (animation, value) => (animation.current = value),\n        onFrame: () => true,\n        current: 0,\n        animationIndex: 0,\n        reduceMotion: getReduceMotionForAnimation(reduceMotion),\n      } as SequenceAnimation;\n    });\n  }\n\n  return defineAnimation<SequenceAnimation>(\n    _animations[0] as SequenceAnimation,\n    () => {\n      'worklet';\n\n      const animations = _animations.map((a) => {\n        const result = typeof a === 'function' ? a() : a;\n        result.finished = false;\n        return result;\n      });\n\n      function findNextNonReducedMotionAnimationIndex(index: number) {\n        // the last animation is returned even if reduced motion is enabled,\n        // because we want the sequence to finish at the right spot\n        while (\n          index < animations.length - 1 &&\n          animations[index].reduceMotion\n        ) {\n          index++;\n        }\n\n        return index;\n      }\n\n      const callback = (finished: boolean): void => {\n        if (finished) {\n          // we want to call the callback after every single animation\n          // not after all of them\n          return;\n        }\n        // this is going to be called only if sequence has been cancelled\n        animations.forEach((animation) => {\n          if (typeof animation.callback === 'function' && !animation.finished) {\n            animation.callback(finished);\n          }\n        });\n      };\n\n      function sequence(animation: SequenceAnimation, now: Timestamp): boolean {\n        const currentAnim = animations[animation.animationIndex];\n        const finished = currentAnim.onFrame(currentAnim, now);\n        animation.current = currentAnim.current;\n        if (finished) {\n          // we want to call the callback after every single animation\n          if (currentAnim.callback) {\n            currentAnim.callback(true /* finished */);\n          }\n          currentAnim.finished = true;\n          animation.animationIndex = findNextNonReducedMotionAnimationIndex(\n            animation.animationIndex + 1\n          );\n          if (animation.animationIndex < animations.length) {\n            const nextAnim = animations[animation.animationIndex];\n            nextAnim.onStart(nextAnim, currentAnim.current, now, currentAnim);\n            return false;\n          }\n          return true;\n        }\n        return false;\n      }\n\n      function onStart(\n        animation: SequenceAnimation,\n        value: AnimatableValue,\n        now: Timestamp,\n        previousAnimation: SequenceAnimation\n      ): void {\n        // child animations inherit the setting, unless they already have it defined\n        // they will have it defined only if the user used the `reduceMotion` prop\n        animations.forEach((anim) => {\n          if (anim.reduceMotion === undefined) {\n            anim.reduceMotion = animation.reduceMotion;\n          }\n        });\n        animation.animationIndex = findNextNonReducedMotionAnimationIndex(0);\n\n        if (previousAnimation === undefined) {\n          previousAnimation = animations[\n            animations.length - 1\n          ] as SequenceAnimation;\n        }\n\n        const currentAnimation = animations[animation.animationIndex];\n        currentAnimation.onStart(\n          currentAnimation,\n          value,\n          now,\n          previousAnimation\n        );\n      }\n\n      return {\n        isHigherOrder: true,\n        onFrame: sequence,\n        onStart,\n        animationIndex: 0,\n        current: animations[0].current,\n        callback,\n        reduceMotion: getReduceMotionForAnimation(reduceMotion),\n      } as SequenceAnimation;\n    }\n  );\n}\n"],"mappings":"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"}